---
title: Native Android
description: Build native Android apps with Gradle.
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

# Native Android (Gradle)

Canaveral supports native Android applications built with Gradle.

**Supported platforms**: Android

## Detection

Canaveral detects native Android projects by the presence of `build.gradle` or `build.gradle.kts` with the Android plugin.

## Build Commands

### APK Build

```bash
# Debug APK
canaveral build --platform android --profile debug

# Release APK (pass format via extra args)
canaveral build --platform android --profile release -- --build-type apk
```

### AAB Build (Play Store)

```bash
# Release AAB
canaveral build --platform android --profile release
```

<Aside type="note">
  AAB (Android App Bundle) is the default format for release builds as it's required for Play Store.
</Aside>

### Build with Flavor

```bash
canaveral build --platform android --profile release --flavor production
```

## Gradle Support

Canaveral supports:

| Type | Description |
|------|-------------|
| `./gradlew` | Gradle wrapper (recommended) |
| `build.gradle.kts` | Kotlin DSL |
| `build.gradle` | Groovy DSL |
| Build flavors | Multiple app variants |

## Version Management

Version is read from `app/build.gradle` or `app/build.gradle.kts`:

<Tabs>
  <TabItem label="Kotlin DSL">
    ```kotlin title="app/build.gradle.kts"
    android {
        defaultConfig {
            versionCode = 42
            versionName = "1.2.3"
        }
    }
    ```
  </TabItem>
  <TabItem label="Groovy DSL">
    ```groovy title="app/build.gradle"
    android {
        defaultConfig {
            versionCode 42
            versionName "1.2.3"
        }
    }
    ```
  </TabItem>
</Tabs>

```bash
# Show version
canaveral version

# Calculate next version
canaveral version --release-type patch

# Show current version
canaveral version --current
```

## Signing

### Environment Variables (Recommended)

```bash
export ANDROID_KEYSTORE_PATH=/path/to/release.keystore
export ANDROID_KEYSTORE_PASSWORD=password
export ANDROID_KEY_ALIAS=release
export ANDROID_KEY_PASSWORD=password
```

### Build Command Options

```bash
canaveral build --platform android --profile release \
  --keystore "${ANDROID_KEYSTORE_PATH}" \
  --key-alias "${ANDROID_KEY_ALIAS}"
```

Or configure signing in `canaveral.yaml`:

```yaml
signing:
  enabled: true
  provider: android
  android:
    keystore_path: "${ANDROID_KEYSTORE_PATH}"
    key_alias: "${ANDROID_KEY_ALIAS}"
```

### Gradle Signing Config

You can also configure signing in Gradle directly:

```kotlin title="app/build.gradle.kts"
android {
    signingConfigs {
        create("release") {
            storeFile = file(System.getenv("ANDROID_KEYSTORE_PATH"))
            storePassword = System.getenv("ANDROID_KEYSTORE_PASSWORD")
            keyAlias = System.getenv("ANDROID_KEY_ALIAS")
            keyPassword = System.getenv("ANDROID_KEY_PASSWORD")
        }
    }
    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("release")
        }
    }
}
```

## Build Flavors

Configure flavors in your Gradle file:

```kotlin title="app/build.gradle.kts"
android {
    flavorDimensions += "environment"
    productFlavors {
        create("development") {
            dimension = "environment"
            applicationIdSuffix = ".dev"
        }
        create("staging") {
            dimension = "environment"
            applicationIdSuffix = ".staging"
        }
        create("production") {
            dimension = "environment"
        }
    }
}
```

Build with flavor:

```bash
canaveral build --platform android --profile release --flavor production
```

## Build Configuration

Pass additional arguments to Gradle using `--`:

```bash
# Pass extra Gradle args
canaveral build --platform android --profile release -- --stacktrace --info

# Build specific flavor
canaveral build --platform android --profile release --flavor production
```

## Testing

### Tests

```bash
# Run tests
canaveral test --platform android

# Run with filter
canaveral test --platform android --filter "LoginTest"

# JUnit output for CI
canaveral test --platform android --reporter junit --output test-results/results.xml
```

## CI/CD Integration

### GitHub Actions

```yaml
name: Android Build
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Setup Android SDK
        uses: android-actions/setup-android@v3

      - name: Install Canaveral
        run: curl -fsSL https://get.canaveral.dev | sh

      - name: Decode Keystore
        run: echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 -d > release.keystore

      - name: Build
        run: canaveral build --platform android --profile release
        env:
          ANDROID_KEYSTORE_PATH: release.keystore
          ANDROID_KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
          ANDROID_KEY_ALIAS: ${{ secrets.ANDROID_KEY_ALIAS }}
          ANDROID_KEY_PASSWORD: ${{ secrets.ANDROID_KEY_PASSWORD }}

      - name: Upload to Play Store
        run: canaveral publish google-play --artifact build/android/*.aab --track internal
        env:
          GOOGLE_PLAY_SERVICE_ACCOUNT_KEY: ${{ secrets.GOOGLE_PLAY_SERVICE_ACCOUNT_KEY }}
```

## Troubleshooting

### "Gradle not found"

Ensure Gradle wrapper is present:

```bash
gradle wrapper
```

Or install Gradle:

```bash
brew install gradle
```

### "JAVA_HOME not set"

Set the Java home:

```bash
export JAVA_HOME=$(/usr/libexec/java_home -v 17)
```

### "Build failed with R8"

Check ProGuard rules in `proguard-rules.pro`. Common issues:
- Missing keep rules for reflection
- Serialization issues

### "Keystore not found"

Verify the keystore path:

```bash
ls -la $ANDROID_KEYSTORE_PATH
```

Ensure it's accessible in CI:

```bash
echo "$KEYSTORE_BASE64" | base64 -d > release.keystore
```
