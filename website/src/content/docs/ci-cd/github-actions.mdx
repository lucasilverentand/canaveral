---
title: GitHub Actions
description: Set up CI/CD with GitHub Actions.
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

# GitHub Actions

Complete guide to setting up Canaveral with GitHub Actions.

## Quick Start

Create `.github/workflows/build.yml`:

```yaml
name: Build
on: [push, pull_request]

jobs:
  build-ios:
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4

      - name: Install Canaveral
        run: |
          curl -fsSL https://get.canaveral.dev | sh
          echo "$HOME/.canaveral/bin" >> $GITHUB_PATH

      - name: Build iOS
        run: canaveral build --platform ios --profile release --format json

  build-android:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Canaveral
        run: |
          curl -fsSL https://get.canaveral.dev | sh
          echo "$HOME/.canaveral/bin" >> $GITHUB_PATH

      - name: Build Android
        run: canaveral build --platform android --profile release --format json
```

## Full CI/CD Pipeline

### Build, Test, and Deploy

```yaml
name: CI/CD
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Canaveral
        run: curl -fsSL https://get.canaveral.dev | sh
      - name: Run Tests
        run: canaveral test --reporter junit --output test-results/results.xml
      - name: Upload Test Results
        uses: actions/upload-artifact@v4
        with:
          name: test-results
          path: test-results/*.xml

  build-ios:
    needs: test
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4

      - name: Install Canaveral
        run: |
          curl -fsSL https://get.canaveral.dev | sh
          echo "$HOME/.canaveral/bin" >> $GITHUB_PATH

      - name: Sync Certificates
        run: canaveral match sync --profile-type appstore --readonly
        env:
          MATCH_GIT_URL: ${{ vars.MATCH_GIT_URL }}
          MATCH_PASSWORD: ${{ secrets.MATCH_PASSWORD }}

      - name: Build iOS
        run: canaveral build --platform ios --profile release --format json

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ios-build
          path: build/ios/*.ipa

  build-android:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Install Canaveral
        run: |
          curl -fsSL https://get.canaveral.dev | sh
          echo "$HOME/.canaveral/bin" >> $GITHUB_PATH

      - name: Decode Keystore
        run: echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 -d > android/app/release.keystore

      - name: Build Android
        run: canaveral build --platform android --profile release --format json
        env:
          ANDROID_KEYSTORE_PATH: android/app/release.keystore
          ANDROID_KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
          ANDROID_KEY_ALIAS: ${{ secrets.ANDROID_KEY_ALIAS }}
          ANDROID_KEY_PASSWORD: ${{ secrets.ANDROID_KEY_PASSWORD }}

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: android-build
          path: build/android/*.aab

  deploy:
    needs: [build-ios, build-android]
    runs-on: macos-14
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4

      - name: Download iOS Build
        uses: actions/download-artifact@v4
        with:
          name: ios-build
          path: build/ios

      - name: Download Android Build
        uses: actions/download-artifact@v4
        with:
          name: android-build
          path: build/android

      - name: Install Canaveral
        run: |
          curl -fsSL https://get.canaveral.dev | sh
          echo "$HOME/.canaveral/bin" >> $GITHUB_PATH

      - name: Upload to TestFlight
        run: canaveral testflight upload build/ios/*.ipa
        env:
          APP_STORE_CONNECT_API_KEY_ID: ${{ secrets.APP_STORE_CONNECT_API_KEY_ID }}
          APP_STORE_CONNECT_ISSUER_ID: ${{ secrets.APP_STORE_CONNECT_ISSUER_ID }}
          APP_STORE_CONNECT_API_KEY_PATH: ${{ secrets.APP_STORE_CONNECT_API_KEY_PATH }}

      - name: Upload to Play Store
        run: canaveral publish google-play --artifact build/android/*.aab --track internal
        env:
          GOOGLE_PLAY_SERVICE_ACCOUNT_KEY: ${{ secrets.GOOGLE_PLAY_SERVICE_ACCOUNT_KEY }}
```

## Required Secrets

Configure these secrets in your repository settings:

### iOS

| Secret | Description |
|--------|-------------|
| `MATCH_PASSWORD` | Encryption password for certificates |
| `APP_STORE_CONNECT_API_KEY_ID` | App Store Connect API key ID |
| `APP_STORE_CONNECT_ISSUER_ID` | App Store Connect issuer ID |
| `APP_STORE_CONNECT_API_KEY_PATH` | Path to API key .p8 file |

### Android

| Secret | Description |
|--------|-------------|
| `ANDROID_KEYSTORE_BASE64` | Base64-encoded keystore |
| `ANDROID_KEYSTORE_PASSWORD` | Keystore password |
| `ANDROID_KEY_ALIAS` | Signing key alias |
| `ANDROID_KEY_PASSWORD` | Signing key password |
| `GOOGLE_PLAY_SERVICE_ACCOUNT` | Service account JSON |

### Variables

| Variable | Description |
|----------|-------------|
| `MATCH_GIT_URL` | Git URL for certificate storage |

## Output Format

Using `--format json` automatically:

1. Sets environment variables for subsequent steps
2. Creates step outputs for use in other jobs
3. Adds annotations for build warnings/errors
4. Integrates with GitHub's job summary

```yaml
- name: Build
  id: build
  run: canaveral build --platform ios --format json

- name: Use Output
  run: echo "Artifact path: ${{ steps.build.outputs.artifact_path }}"
```

## Caching

Speed up builds with caching:

```yaml
- name: Cache Canaveral
  uses: actions/cache@v4
  with:
    path: ~/.canaveral
    key: canaveral-${{ runner.os }}

- name: Cache Dependencies
  uses: actions/cache@v4
  with:
    path: |
      ~/.pub-cache
      ~/Library/Caches/CocoaPods
      ~/.gradle/caches
    key: deps-${{ runner.os }}-${{ hashFiles('**/pubspec.lock', '**/Podfile.lock', '**/build.gradle') }}
```
